import dotenv from 'dotenv'
dotenv.config()
///////////////////////////////////////////////////////////////////////////////
// EXPRESS
///////////////////////////////////////////////////////////////////////////////

import express from 'express'
const app = express()

import bodyParser from 'body-parser'
app.use(bodyParser.json())

//const cors = require('cors')
//app.use(cors())

import auth from './middleware/auth.js'

///////////////////////////////////////////////////////////////////////////////
// MONGOOSE
///////////////////////////////////////////////////////////////////////////////

import mongoose from 'mongoose'

mongoose.connect(process.env.DATABASE_URL, {
	useNewUrlParser: true,
	useUnifiedTopology: true,
	useCreateIndex: true
})

const connection = mongoose.connection

connection.once('open', () => {
	console.log('MongoDB connection established successfully')
})

///////////////////////////////////////////////////////////////////////////////
// INCLUDE SOME TEST ROUTES
///////////////////////////////////////////////////////////////////////////////

import { flatTestData, dbTestData } from './components-test/testpaths.js'

flatTestData(app)
dbTestData(app)

///////////////////////////////////////////////////////////////////////////////
// RANDOM TEST JUNK
///////////////////////////////////////////////////////////////////////////////

app.get('/', auth, (req, res) => {
	res.status(200).send('ok')
})

///////////////////////////////////////////////////////////////////////////////
// AUTH ROUTES
///////////////////////////////////////////////////////////////////////////////

import apiUsers from './routes/users.js'
import apiAuth from './routes/userAuth.js'

app.use('/api/users', apiUsers)
app.use('/api/auth', apiAuth)

///////////////////////////////////////////////////////////////////////////////
// CONTACTS ROUTES
///////////////////////////////////////////////////////////////////////////////

import contactsRoute from './routes/contacts.js'
app.use('/api/contacts', contactsRoute)

///////////////////////////////////////////////////////////////////////////////
// INSTANTIATE THE SERVER
///////////////////////////////////////////////////////////////////////////////

const port = 5000

app.listen(port, function () {
	console.log(`Example app listening on port ${port}`)
})
